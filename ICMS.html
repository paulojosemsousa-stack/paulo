<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöö Simulador de Cr√©dito ICMS - Transportadoras</title>
    <style>
        /* Estilos CSS para Organiza√ß√£o e Visualiza√ß√£o */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #4CAF50 0%, #1a921d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #2E7D32;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
        }

        .tabs {
            display: flex;
            background: #e8f5e9;
            border-bottom: 1px solid #c8e6c9;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            color: #2E7D32;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #4CAF50;
            color: #1b5e20;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 800px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .form-section, .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background: #388E3C;
        }

        .result-card {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 5px 10px rgba(0,0,0,0.05);
        }

        .result-value {
            font-size: 2.0em;
            font-weight: bold;
            color: #1b5e20;
            margin: 10px 0;
        }

        .alert-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .alert-warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .state-config {
            background: #f0f4f7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
            border-left: 3px solid #2196F3;
        }

        .calculation-steps {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöö Simulador de Cr√©dito ICMS - Transportadoras</h1>
            <p>Cr√©dito Efetivo para Diesel e Outros Insumos (Brasil)</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'diesel')">‚õΩ Diesel (Monof√°sico)</button>
            <button class="tab" onclick="openTab(event, 'insumos')">üõ†Ô∏è Outros Insumos (Ad Valorem)</button>
        </div>

        <div id="diesel" class="tab-content active">
            <div class="content">
                <div class="form-section">
                    <h2>‚õΩ C√°lculo do Cr√©dito de Diesel</h2>
                    
                    <div class="form-group">
                        <label for="stateDiesel">Estado da Transportadora:</label>
                        <select id="stateDiesel" onchange="updateDieselConfig(); calculateDiesel()">
                            <option value="">Selecione o estado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="liters">Quantidade de Litros Abastecidos:</label>
                        <input type="number" id="liters" placeholder="Ex: 1000" step="0.01" oninput="calculateDiesel()">
                    </div>

                    <div id="stateConfigDiesel" class="state-config" style="display: none;">
                    </div>

                    <button class="btn" onclick="calculateDiesel()">
                        üßÆ Calcular Cr√©dito do Diesel
                    </button>
                </div>

                <div class="results-section">
                    <h2>üìä Resultado - Diesel</h2>
                    <div id="resultsDiesel" style="display: none;">
                    </div>
                    <div id="noResultsDiesel" class="alert-info">
                        ‚ö†Ô∏è Selecione o estado e informe a quantidade de litros para calcular.
                    </div>
                </div>
            </div>
        </div>

        <div id="insumos" class="tab-content">
            <div class="content">
                <div class="form-section">
                    <h2>üõ†Ô∏è C√°lculo de Outros Insumos</h2>
                    
                    <div class="form-group">
                        <label for="stateInsumos">Estado da Transportadora:</label>
                        <select id="stateInsumos" onchange="updateInsumosConfig(); calculateInsumos()">
                            <option value="">Selecione o estado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="categoria">Categoria do Insumo:</label>
                        <select id="categoria" onchange="updateInsumosConfig(); calculateInsumos()">
                            <option value="">Selecione a categoria</option>
                            <option value="pecas">Pe√ßas de Reposi√ß√£o</option>
                            <option value="pneus">Pneus e C√¢maras</option>
                            <option value="lubrificantes">Lubrificantes/√ìleos</option>
                            <option value="equipamentos">Ativo Imobilizado (Caminh√µes/M√°quinas)</option>
                            <option value="outros">Outros Insumos (Ex: Aditivos)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="valorInsumo">Valor Total do Insumo (R$):</label>
                        <input type="number" id="valorInsumo" placeholder="Ex: 5000.00" step="0.01" oninput="calculateInsumos()">
                    </div>

                    <div id="stateConfigInsumos" class="state-config" style="display: none;">
                    </div>

                    <button class="btn" onclick="calculateInsumos()">
                        üßÆ Calcular Cr√©dito
                    </button>
                </div>

                <div class="results-section">
                    <h2>üìä Resultado - Outros Insumos</h2>
                    <div id="resultsInsumos" style="display: none;">
                    </div>
                    <div id="noResultsInsumos" class="alert-info">
                        ‚ö†Ô∏è Preencha todos os dados para calcular o cr√©dito.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DADOS TRIBUT√ÅRIOS CHAVE
        const BASE_CONFAZ_DIESEL = 0.9456; // Conv√™nio ICMS 199/2022 - Al√≠quota Ad Rem Nacional
        const ALIQ_INSUMOS_PADRAO = 18; // Al√≠quota interna comum para insumos

        // Configura√ß√£o por Estado
        // Fator: 1.0000 indica ades√£o √† regra geral. SP tem fator de corre√ß√£o (FCV)
        const estadosConfig = {
            'SP': { name: 'S√£o Paulo', diesel: { fator: 0.9976, legislacao: 'Decis√£o CAT 02/2024' }, insumos: { aliq: 18 } },
            'MG': { name: 'Minas Gerais', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 18 } },
            'RJ': { name: 'Rio de Janeiro', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 18 } },
            'ES': { name: 'Esp√≠rito Santo', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 17 } },
            'PR': { name: 'Paran√°', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 18 } },
            'SC': { name: 'Santa Catarina', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 17 } },
            'RS': { name: 'Rio Grande do Sul', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 17.5 } },
            'BA': { name: 'Bahia', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 19 } },
            'GO': { name: 'Goi√°s', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 17 } },
            'DF': { name: 'Distrito Federal', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 18 } },
            'AM': { name: 'Amazonas', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 18 } },
            'MT': { name: 'Mato Grosso', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: 17 } },
            // Demais estados usam a regra geral do CONFAZ e a al√≠quota interna padr√£o de 18% para o exemplo
            'AL': { name: 'Alagoas', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'AP': { name: 'Amap√°', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'AC': { name: 'Acre', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'CE': { name: 'Cear√°', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'MA': { name: 'Maranh√£o', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'MS': { name: 'Mato Grosso do Sul', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'PA': { name: 'Par√°', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'PB': { name: 'Para√≠ba', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'PE': { name: 'Pernambuco', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'PI': { name: 'Piau√≠', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'RN': { name: 'Rio Grande do Norte', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'RO': { name: 'Rond√¥nia', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'RR': { name: 'Roraima', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'SE': { name: 'Sergipe', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
            'TO': { name: 'Tocantins', diesel: { fator: 1.0000, legislacao: 'Regra Geral' }, insumos: { aliq: ALIQ_INSUMOS_PADRAO } },
        };

        // Fun√ß√£o para formatar moeda
        const formatCurrency = (value) => {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        };

        // 1. Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            initSelectors();
        });

        function initSelectors() {
            const stateSelects = ['stateDiesel', 'stateInsumos'];
            const ufKeys = Object.keys(estadosConfig).sort();

            stateSelects.forEach(id => {
                const select = document.getElementById(id);
                ufKeys.forEach(uf => {
                    const option = document.createElement('option');
                    option.value = uf;
                    option.textContent = `${uf} - ${estadosConfig[uf].name}`;
                    select.appendChild(option);
                });
            });
        }

        // 2. Troca de Abas
        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // 3. Fun√ß√µes de Configura√ß√£o (Exibir dados na tela)

        function updateDieselConfig() {
            const uf = document.getElementById('stateDiesel').value;
            const configDiv = document.getElementById('stateConfigDiesel');
            
            if (uf && estadosConfig[uf]) {
                const config = estadosConfig[uf].diesel;
                const fatorInfo = config.fator === 1.0000 ? 'Regra geral do CONFAZ, sem FCV.' : `Fator de Corre√ß√£o Estadual (FCV): ${config.fator.toFixed(4)}`;

                configDiv.innerHTML = `
                    <strong>Configura√ß√£o ICMS Diesel (${uf}):</strong><br>
                    ‚Ä¢ Al√≠quota *Ad Rem* (CONFAZ): R$ ${BASE_CONFAZ_DIESEL.toFixed(4)}/L<br>
                    ‚Ä¢ ${fatorInfo}<br>
                    ‚Ä¢ **Base Legal**: ${config.legislacao}
                `;
                configDiv.style.display = 'block';
            } else {
                configDiv.style.display = 'none';
            }
        }

        function updateInsumosConfig() {
            const uf = document.getElementById('stateInsumos').value;
            const categoria = document.getElementById('categoria').value;
            const configDiv = document.getElementById('stateConfigInsumos');
            
            if (uf && categoria && estadosConfig[uf]) {
                const aliq = estadosConfig[uf].insumos.aliq;
                
                configDiv.innerHTML = `
                    <strong>Configura√ß√£o ICMS Insumos (${uf}):</strong><br>
                    ‚Ä¢ Al√≠quota ICMS Interna (Est. para o Exemplo): ${aliq.toFixed(2)}%<br>
                    ‚Ä¢ **Tipo de C√°lculo**: Ad Valorem (Valor da Nota √ó Al√≠quota)<br>
                    ‚Ä¢ **Aviso**: Esta √© uma al√≠quota interna gen√©rica. Consulte o RICMS/Regulamento do seu estado (UF) para al√≠quotas exatas de cada NCM (item).
                `;
                configDiv.style.display = 'block';
            } else {
                configDiv.style.display = 'none';
            }
        }

        // 4. Fun√ß√µes de C√°lculo

        function calculateDiesel() {
            const uf = document.getElementById('stateDiesel').value;
            const liters = parseFloat(document.getElementById('liters').value);
            const resultsDiv = document.getElementById('resultsDiesel');
            const noResultsDiv = document.getElementById('noResultsDiesel');

            if (!uf || isNaN(liters) || liters <= 0) {
                resultsDiv.style.display = 'none';
                noResultsDiv.style.display = 'block';
                return;
            }

            const config = estadosConfig[uf].diesel;
            
            // C√°lculo: Litros * Base Ad Rem * Fator Estadual
            const creditoICMS = liters * BASE_CONFAZ_DIESEL * config.fator;

            resultsDiv.innerHTML = `
                <div class="result-card">
                    Cr√©dito ICMS Estimado (Diesel)
                    <div class="result-value">${formatCurrency(creditoICMS)}</div>
                </div>
                <div class="alert-info">
                    **Princ√≠pio Legal:** O cr√©dito √© obtido pela multiplica√ß√£o da quantidade de litros pela al√≠quota *ad rem* fixada pelo CONFAZ, ajustada por fatores estaduais (se aplic√°vel), conforme a legisla√ß√£o da tributa√ß√£o monof√°sica (Conv√™nio ICMS 199/2022).
                </div>
                <div class="calculation-steps">
                    <strong>Detalhes do C√°lculo:</strong><br>
                    ${liters.toFixed(2)} L √ó R$ ${BASE_CONFAZ_DIESEL.toFixed(4)}/L √ó ${config.fator.toFixed(4)} (Fator ${uf}) = ${formatCurrency(creditoICMS)}
                </div>
            `;
            resultsDiv.style.display = 'block';
            noResultsDiv.style.display = 'none';
        }

        function calculateInsumos() {
            const uf = document.getElementById('stateInsumos').value;
            const categoria = document.getElementById('categoria').value;
            const valorNota = parseFloat(document.getElementById('valorInsumo').value);
            const resultsDiv = document.getElementById('resultsInsumos');
            const noResultsDiv = document.getElementById('noResultsInsumos');

            if (!uf || !categoria || isNaN(valorNota) || valorNota <= 0) {
                resultsDiv.style.display = 'none';
                noResultsDiv.style.display = 'block';
                return;
            }

            const aliq = estadosConfig[uf].insumos.aliq / 100; // Al√≠quota em decimal
            
            // C√°lculo Simples: Valor da Nota * Al√≠quota Interna
            const creditoICMS_Bruto = valorNota * aliq;

            // Aviso especial para Ativo Imobilizado
            let avisoAtivo = '';
            if (categoria === 'equipamentos') {
                avisoAtivo = '<div class="alert-warning">‚ö†Ô∏è ATEN√á√ÉO CIAP: O cr√©dito de Ativo Imobilizado √© apropriado em 48 parcelas mensais, proporcionalmente √†s sa√≠das tributadas. Este valor √© o cr√©dito total bruto.</div>';
            }

            resultsDiv.innerHTML = `
                <div class="result-card">
                    Cr√©dito ICMS Bruto Estimado
                    <div class="result-value">${formatCurrency(creditoICMS_Bruto)}</div>
                </div>
                <div class="alert-warning">
                    **COMPLEXIDADE CR√çTICA:** O cr√©dito final deve ser **proporcional** ao percentual de presta√ß√µes de servi√ßo de transporte tributadas pela transportadora no per√≠odo, e limitado ao ICMS **destacado** na Nota Fiscal. Este c√°lculo mostra o valor bruto, usando a al√≠quota interna de ${estadosConfig[uf].insumos.aliq.toFixed(2)}%.
                </div>
                ${avisoAtivo}
                <div class="calculation-steps">
                    <strong>Detalhes do C√°lculo (Bruto):</strong><br>
                    Valor da Nota: ${formatCurrency(valorNota)}<br>
                    Al√≠quota Est. (${uf}): ${estadosConfig[uf].insumos.aliq.toFixed(2)}%<br>
                    Cr√©dito Bruto = ${formatCurrency(valorNota)} √ó ${aliq.toFixed(4)} = ${formatCurrency(creditoICMS_Bruto)}
                </div>
            `;
            resultsDiv.style.display = 'block';
            noResultsDiv.style.display = 'none';
        }
    </script>
</body>
</html>